# パスワードマネージャー

パスワードを管理するパスワードマネージャーを、シェルスクリプトを利用して作成しましょう。

パスワードマネージャーとは、IDとパスワードを安全に管理するためのツールです。多くのサービスでログイン時にパスワードが必要となりますが、全てを覚えるのは困難ですし、覚えやすいパスワードを使い回すのはセキュリティ上危険です。

そこで、各サービスのIDとパスワードを保存するパスワードマネージャーを作成します。

なお、ChatGPT 等の生成 AI は使用は非推奨、またコピペだけの利用については禁止とします。生成 AI は有用なのですが、AI が書いたコードを見てしまうと、そのコードに考えが引きずられるため、コードを書く力が身につかず、自分で考えて実装する楽しさも味わうこともできません。コピペに至っては何のスキルも身につかないですし、楽しさもありません。自分で考えてトライ・アンド・エラーする楽しさを味わっていただきいですし、エンジニアとして活躍するためのスキルを身につけていただきたいと考えております。

## ステップ1

パスワードを保存する処理を、シェルスクリプトで作成します。

以下の情報を保存できるようにします。この情報はファイルに保存してください。

- サービス名
- ユーザー名
- パスワード

シェルスクリプトを実行すると、以下が表示されます。

```bash
パスワードマネージャーへようこそ！
サービス名を入力してください：
ユーザー名を入力してください：
パスワードを入力してください：
# 入力が完了したら
Thank you!
```

サービス名、ユーザー名、パスワードの入力が求められ、入力された情報を "サービス名:ユーザー名:パスワード" という形式でファイルに保存します。シェルスクリプトを実行するたびに入力された情報はファイルに追記されるようにしてください。

### パスワードマネージャー ... ステップ1

<details><summary>password_manager.sh</summary> 

```bash
#!/bin/bash
#シェルスクリプト実行時の表示メッセージ、read -p でプロンプトを表示させて入力を受ける。
echo "パスワードマネージャーへようこそ！"

read -p "サービス名を入力してください：" service_name
read -p "ユーザー名を入力してください：" user_name
#パスワードは -s オプションで表示させないようにする。
read -s -p "パスワードを入力してください：" password

#シェルスクリプトが保存されているディレクトリ内に、入力情報を保存するファイルを指定
password_file="$(dirname "${BASH_SOURCE[0]}")/password_file.txt"

#指定したファイルに、サービス名、パスワード名、パスワードを追記
echo "$service_name:$user_name:$password" >> $password_file

echo "Thank you!"
```
</details>

## ステップ2

パスワードを保存し、出力するパスワードマネージャーをシェルスクリプトで作成します。パスワードの暗号化はしません。

以下の情報を保存・出力できるようにします。この情報はファイルに保存してください。

- サービス名
- ユーザー名
- パスワード

シェルスクリプトを実行すると、以下のメニューが表示されます。

```bash
パスワードマネージャーへようこそ！
次の選択肢から入力してください(Add Password/Get Password/Exit)：
```

Add Password が入力されると、サービス名、ユーザー名、パスワードの入力が求められ、入力された情報をファイルに保存します。
Get Password が入力されると、サービス名の入力が求められ、入力されたサービスのサービス名、ユーザー名、パスワードが表示されます。
Exit が入力されると、プログラムが終了します。
Exit が入力されるまではプログラムは終了せず、「次の選択肢から入力してください(Add Password/Get Password/Exit)：」が繰り返されます。

▼呼び出し

```bash
./password_manager.sh
```

▼アウトプット

```bash
パスワードマネージャーへようこそ！
次の選択肢から入力してください(Add Password/Get Password/Exit)：

# Add Password が入力された場合
サービス名を入力してください：
ユーザー名を入力してください：
パスワードを入力してください：

パスワードの追加は成功しました。
次の選択肢から入力してください(Add Password/Get Password/Exit)：

# Get Password が入力された場合
サービス名を入力してください：
## サービス名が保存されていなかった場合
そのサービスは登録されていません。
## サービス名が保存されていた場合
サービス名：hoge
ユーザー名：fuga
パスワード：piyo

次の選択肢から入力してください(Add Password/Get Password/Exit)：

# Exit が入力された場合
Thank you!
## プログラムが終了

# Add Password/Get Password/Exit 以外が入力された場合
入力が間違えています。Add Password/Get Password/Exit から入力してください。
```

### パスワードマネージャー ... ステップ2

<details><summary>password_manager.sh</summary>

```bash
#!/bin/bash
#シェルスクリプト実行時の表示メッセージ
echo -e "パスワードマネージャーへようこそ！"

#シェルスクリプトが保存されているディレクトリ内に、入力情報を保存するファイルを指定
password_file="$(dirname "${BASH_SOURCE[0]}")/password_file.txt"

while true; do
    #キーボード入力を受け取り、choice 変数に代入
    echo
    read -p "次の選択肢から入力してください([add]-Add Password/[get]-Get Password/[exit]-Exit)：" choice

    case "$choice" in
        "add")
            #read -p でプロンプトを表示させて入力を受ける。
            read -p "サービス名を入力してください：" service_name
            read -p "ユーザー名を入力してください：" user_name
            #パスワードは -s オプションで表示させないようにする。
            read -s -p "パスワードを入力してください：" password

            #指定したファイルに、サービス名、パスワード名、パスワードを追記
            echo "$service_name:$user_name:$password" >> $password_file
            echo -e "\nパスワードの追加は成功しました。"
            ;;
        "get")
            #プロンプトでサービス名を入力する
            read -p "サービス名を入力してください：" service_name

            #該当のサービス名が password_file.txt 内に存在するかを grep で検索
            grep -q "^${service_name}:" $password_file

            #サービス名の登録情報があれば、ループでユーザー名とパスワードまで表示
            #サービス名が password_file.txt 内に見つからなければ、「登録なし」を表示
            if (($? == 0)); then
                items=([1]=サービス名： [2]=ユーザー名： [3]=パスワード：)
                for i in {1..3}; do
                    field=$(grep $service_name $password_file | cut -d ":" -f $i)
                    echo "${items[$i]}$field"
                done
            else
                echo "そのサービスは登録されていません。"
            fi
            ;;
        "exit")
            #パスワードの追加および検索を終了
            echo  "Thank you!"
            exit
            ;;
        *)
            #プロンプトに add, get, exit 以外を入力してしまった場合
            echo "入力が間違えています。[add]-Add Password/[get]-Get Password/[exit]-Exit から入力してください。"
            ;;
    esac
done
```
</details>

## ステップ3(任意)

パスワードが保存されたファイルを暗号化しましょう。ファイルが暗号化されていないとパスワードがファイルから直接確認可能なためセキュリティ上危険性が高いです。

暗号化には好きなツールを使っていただいて構いません。なお、有名なものには GnuPG(GNU Privacy Guard) があります。

具体的には、以下の仕様を追加します。

- Add Password が入力された場合、サービス名、ユーザー名、パスワードをファイルに保存した後にファイルを暗号化します
- 暗号化されたファイルを開いて、パスワードが読み取れないことを確認してください
- Get Password が入力された場合、暗号化されたファイルを復号化して（元の状態に戻して）サービス名、ユーザー名、パスワードを表示します。なおその際に、ファイルそのものは暗号化された状態を維持してください（Get Password後にファイルを開いてもファイルは暗号化されています）
